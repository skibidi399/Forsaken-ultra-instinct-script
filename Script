local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local lp = Players.LocalPlayer

-- Settings
local ultraInstinctOn = false
local currentDirection = 1
local lastDodge = 0
local dodgeCooldown = 1
local radius = 20
local directions = {"Left", "Right", "Forward", "Backward"}

-- Replace with your real animation IDs
local dodgeAnims = {
	Left = "rbxassetid://YOUR_LEFT_ANIM_ID",
	Right = "rbxassetid://YOUR_RIGHT_ANIM_ID",
	Forward = "rbxassetid://YOUR_FORWARD_ANIM_ID",
	Backward = "rbxassetid://YOUR_BACKWARD_ANIM_ID"
}

-- Killer anim IDs to detect
local killerAnims = {
	"126830014841198", "126355327951215", "121086746534252", "18885909645",
	"98456918873918", "105458270463374", "83829782357897", "125403313786645",
	"118298475669935", "82113744478546", "70371667919898", "99135633258223",
	"97167027849946", "109230267448394", "139835501033932", "126896426760253",
	"109667959938617", "126681776859538", "129976080405072", "121293883585738"
}

-- GUI
local function createGui()
	local gui = Instance.new("ScreenGui", lp:WaitForChild("PlayerGui"))
	gui.Name = "UltraInstinctGui"
	gui.ResetOnSpawn = false

	local toggle = Instance.new("TextButton", gui)
	toggle.Position = UDim2.new(0, 20, 0, 100)
	toggle.Size = UDim2.new(0, 160, 0, 40)
	toggle.Text = "Ultra Instinct: OFF"
	toggle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	toggle.TextColor3 = Color3.new(1, 1, 1)
	toggle.Font = Enum.Font.Gotham
	toggle.TextScaled = true

	local directionButton = Instance.new("TextButton", gui)
	directionButton.Position = UDim2.new(0, 20, 0, 150)
	directionButton.Size = UDim2.new(0, 160, 0, 40)
	directionButton.Text = "Dodge: Left"
	directionButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
	directionButton.TextColor3 = Color3.new(1, 1, 1)
	directionButton.Font = Enum.Font.Gotham
	directionButton.TextScaled = true

	local radiusBox = Instance.new("TextBox", gui)
	radiusBox.Position = UDim2.new(0, 20, 0, 200)
	radiusBox.Size = UDim2.new(0, 160, 0, 40)
	radiusBox.Text = tostring(radius)
	radiusBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	radiusBox.TextColor3 = Color3.new(1, 1, 1)
	radiusBox.Font = Enum.Font.Gotham
	radiusBox.TextScaled = true

	-- Toggle logic
	toggle.MouseButton1Click:Connect(function()
		ultraInstinctOn = not ultraInstinctOn
		toggle.Text = ultraInstinctOn and "Ultra Instinct: ON" or "Ultra Instinct: OFF"
		toggle.BackgroundColor3 = ultraInstinctOn and Color3.fromRGB(0, 170, 255) or Color3.fromRGB(50, 50, 50)
	end)

	directionButton.MouseButton1Click:Connect(function()
		currentDirection += 1
		if currentDirection > #directions then currentDirection = 1 end
		directionButton.Text = "Dodge: " .. directions[currentDirection]
	end)

	radiusBox.FocusLost:Connect(function()
		local num = tonumber(radiusBox.Text)
		if num then
			radius = num
		end
	end)

	return gui
end

local function playDodge()
	local char = lp.Character
	if not char then return end
	local hrp = char:FindFirstChild("HumanoidRootPart")
	local hum = char:FindFirstChildOfClass("Humanoid")
	if not hrp or not hum then return end

	local dir = directions[currentDirection]
	local offset = Vector3.new()

	if dir == "Left" then
		offset = -hrp.CFrame.RightVector * 7
	elseif dir == "Right" then
		offset = hrp.CFrame.RightVector * 7
	elseif dir == "Forward" then
		offset = hrp.CFrame.LookVector * 7
	elseif dir == "Backward" then
		offset = -hrp.CFrame.LookVector * 7
	end

	-- Play animation
	local anim = Instance.new("Animation")
	anim.AnimationId = dodgeAnims[dir]
	local track = hum:LoadAnimation(anim)
	track:Play()

	-- Instant TP
	hrp.CFrame = hrp.CFrame + offset
end

-- Watch killer animations
RunService.Heartbeat:Connect(function()
	if not ultraInstinctOn then return end
	if tick() - lastDodge < dodgeCooldown then return end

	for _, plr in ipairs(Players:GetPlayers()) do
		if plr ~= lp and plr.Character and (plr.Character.HumanoidRootPart.Position - lp.Character.HumanoidRootPart.Position).Magnitude < radius then
			local animator = plr.Character:FindFirstChildWhichIsA("Humanoid") and plr.Character:FindFirstChildWhichIsA("Humanoid"):FindFirstChildOfClass("Animator")
			if animator then
				for _, track in ipairs(animator:GetPlayingAnimationTracks()) do
					if table.find(killerAnims, tostring(track.Animation.AnimationId):match("%d+")) then
						lastDodge = tick()
						playDodge()
						return
					end
				end
			end
		end
	end
end)

-- GUI + Persistence
createGui()

lp.CharacterAdded:Connect(function()
	task.wait(1)
	if not lp:WaitForChild("PlayerGui"):FindFirstChild("UltraInstinctGui") then
		createGui()
	end
end)
